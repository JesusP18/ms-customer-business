openapi: 3.0.1
info:
  title: Customer API
  description: API para gestionar clientes y sus productos asociados
  version: 1.0.0
servers:
  - url: http://localhost:8080

paths:
  /api/customers:
    get:
      summary: Listar todos los clientes
      operationId: getAllCustomers
      responses:
        '200':
          description: Lista de clientes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CustomerResponse'
    post:
      summary: Crear un cliente
      operationId: createCustomer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerCreateRequest'
      responses:
        '201':
          description: Cliente creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'

  /api/customers/{id}:
    get:
      summary: Obtener cliente por ID
      operationId: getCustomerById
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Cliente encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'
    put:
      summary: Actualizar cliente
      operationId: updateCustomer
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerUpdateRequest'
      responses:
        '200':
          description: Cliente actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerResponse'
    delete:
      summary: Eliminar cliente
      operationId: deleteCustomer
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        '204':
          description: Cliente eliminado
  /api/customers/{id}/products:
    get:
      summary: Listar productos por id de un cliente
      operationId: getCustomerProducts
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Lista de productos del cliente por id
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductResponse'
    post:
      summary: Agrega un producto a un cliente
      operationId: addProductToCustomer
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductRequest'
      responses:
        '204':
          description: Producto agregado al cliente
  /api/customers/{id}/products/{productId}:
    delete:
      summary: Elimina un producto de un cliente
      operationId: removeProductFromCustomer
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
        - in: path
          name: productId
          schema:
            type: string
          required: true
      responses:
        '204':
          description: Producto eliminado del cliente
components:
  schemas:
    CustomerCreateRequest:
      type: object
      properties:
        customerType:
          type: string
          enum: [PERSONAL, BUSINESS]
        profile:
          type: string
          enum: [STANDARD, VIP, PYME]
          description: Perfil del cliente, por defecto STANDARD.
        firstName:
          type: string
        lastName:
          type: string
        businessName:
          type: string
        dni:
          type: string
        ruc:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string

    CustomerResponse:
      type: object
      properties:
        id:
          type: string
        customerType:
          type: string
          enum: [PERSONAL, BUSINESS]
        profile:
          type: string
          enum: [STANDARD, VIP, PYME]
        firstName:
          type: string
        lastName:
          type: string
        businessName:
          type: string
        dni:
          type: string
        ruc:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string

    CustomerUpdateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        businessName:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string

    ProductRequest:
      type: object
      properties:
        customerId:
          type: string
        category:
          type: string
          enum: [LIABILITY, ASSET]
        type:
          type: string
          enum: [ACCOUNT, LOAN, CREDIT_CARD]
        subType:
          type: string
          enum: [SAVINGS, CURRENT, FIXED_TERM, PERSONAL_LOAN, BUSINESS_LOAN, CREDIT_CARD]

    ProductResponse:
      type: object
      properties:
        id:
          type: string
        customerId:
          type: string
        category:
          type: string
          enum: [LIABILITY, ASSET]
        type:
          type: string
          enum: [ACCOUNT, LOAN, CREDIT_CARD]
        subType:
          type: string
          enum: [SAVINGS, CURRENT, FIXED_TERM, PERSONAL_LOAN, BUSINESS_LOAN, CREDIT_CARD]

    ProductIdRequest:
      type: object
      required:
        - productId
      properties:
        productId:
          type: string